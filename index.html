<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SmartGrocer - Shopping List</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        .scrollbar-thin::-webkit-scrollbar { width: 4px; height: 4px; }
        .scrollbar-thin::-webkit-scrollbar-track { background: transparent; }
        .scrollbar-thin::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
        @keyframes fadeIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
        .animate-in { animation: fadeIn 0.2s ease-out forwards; }
    </style>
</head>
<body class="bg-slate-50 text-slate-900">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        // Inline SVG Icons
        const Icon = ({ name, size = 20, className = "" }) => {
            const icons = {
                Plus: <path d="M12 5v14M5 12h14" />,
                Trash2: <path d="M3 6h18M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2M10 11v6M14 11v6" />,
                ShoppingBasket: <path d="m5 11 4-7M19 11l-4-7M2 11h20M3.5 11l1.6 7.4c.2.9 1 1.6 2 1.6h9.8c1 0 1.8-.7 2-1.6l1.7-7.4M9 11v.5c0 .8.7 1.5 1.5 1.5s1.5-.7 1.5-1.5V11M15 11v.5c0 .8.7 1.5 1.5 1.5s1.5-.7 1.5-1.5V11" />,
                CheckSquare: <path d="m9 11 3 3L22 4M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11" />,
                Square: <rect width="18" height="18" x="3" y="3" rx="2" />,
                GripVertical: (
                    <React.Fragment>
                        <circle cx="9" cy="5" r="1"/><circle cx="9" cy="12" r="1"/><circle cx="9" cy="19" r="1"/>
                        <circle cx="15" cy="5" r="1"/><circle cx="15" cy="12" r="1"/><circle cx="15" cy="19" r="1"/>
                    </React.Fragment>
                ),
                Zap: <path d="M13 2 L3 14h9l-1 8 10-12h-9l1-8z" />,
                X: <path d="M18 6 6 18M6 6l12 12" />,
                ArrowDownUp: <path d="m3 16 4 4 4-4M7 20V4M21 8l-4-4-4 4M17 4v16" />,
                History: <path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8M3 3v5h5M12 7v5l4 2" />,
                LayoutGrid: <path d="M3 3h7v7H3zM14 3h7v7h-7zM14 14h7v7h-7zM3 14h7v7H3z" />
            };

            return (
                <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                    {icons[name] || <circle cx="12" cy="12" r="10" />}
                </svg>
            );
        };

        const INITIAL_CATEGORIES = [
            { id: 'fruit-veg', name: 'Fruit & Veg', icon: 'ðŸŽ', color: 'bg-emerald-50 text-emerald-700 border-emerald-100' },
            { id: 'food-cupboard', name: 'Food Cupboard', icon: 'ðŸ¥«', color: 'bg-amber-50 text-amber-700 border-amber-100' },
            { id: 'chilled', name: 'Chilled', icon: 'ðŸ§Š', color: 'bg-sky-50 text-sky-700 border-sky-100' },
            { id: 'frozen', name: 'Frozen', icon: 'â„ï¸', color: 'bg-indigo-50 text-indigo-700 border-indigo-100' },
            { id: 'bakery', name: 'Bakery', icon: 'ðŸ¥', color: 'bg-orange-50 text-orange-700 border-orange-100' },
            { id: 'other', name: 'Other', icon: 'ðŸ“¦', color: 'bg-slate-100 text-slate-700 border-slate-200' }
        ];

        const App = () => {
            const [items, setItems] = useState(() => JSON.parse(localStorage.getItem('groceries-items') || '[]'));
            const [categories, setCategories] = useState(() => JSON.parse(localStorage.getItem('groceries-cats') || JSON.stringify(INITIAL_CATEGORIES)));
            const [freq, setFreq] = useState(() => JSON.parse(localStorage.getItem('groceries-freq') || '{}'));
            const [activeInput, setActiveInput] = useState(null);
            const [showQuickAdd, setShowQuickAdd] = useState(true);
            const [draggedColIdx, setDraggedColIdx] = useState(null);

            useEffect(() => localStorage.setItem('groceries-items', JSON.stringify(items)), [items]);
            useEffect(() => localStorage.setItem('groceries-cats', JSON.stringify(categories)), [categories]);
            useEffect(() => localStorage.setItem('groceries-freq', JSON.stringify(freq)), [freq]);

            const frequentItems = useMemo(() => 
                Object.entries(freq).map(([text, d]) => ({ text, ...d })).sort((a,b) => b.count - a.count).slice(0, 10)
            , [freq]);

            const addItem = (text, catId) => {
                if (!text.trim()) return;
                const clean = text.trim();
                setFreq(prev => ({
                    ...prev,
                    [clean.toLowerCase()]: { count: (prev[clean.toLowerCase()]?.count || 0) + 1, lastCat: catId, label: clean }
                }));
                setItems([{ id: Date.now(), text: clean, category: catId, completed: false }, ...items]);
            };

            const toggleItem = (id) => setItems(items.map(i => i.id === id ? {...i, completed: !i.completed} : i));
            const deleteItem = (id) => setItems(items.filter(i => i.id !== id));
            
            const addColumn = () => {
                const newId = `cat-${Date.now()}`;
                setCategories([...categories, { id: newId, name: 'New Section', icon: 'ðŸ›’', color: 'bg-slate-100 text-slate-700 border-slate-200' }]);
            };

            const deleteColumn = (id) => {
                if (categories.length <= 1) return;
                setCategories(categories.filter(c => c.id !== id));
                setItems(items.filter(i => i.category !== id));
            };

            // Drag and Drop Column Logic
            const onDragStartCol = (e, index) => {
                setDraggedColIdx(index);
                e.dataTransfer.setData('colIndex', index);
            };

            const onDropCol = (e, targetIdx) => {
                e.preventDefault();
                const sourceIdx = parseInt(e.dataTransfer.getData('colIndex'));
                if (isNaN(sourceIdx) || sourceIdx === targetIdx) return;

                const newCats = [...categories];
                const [moved] = newCats.splice(sourceIdx, 1);
                newCats.splice(targetIdx, 0, moved);
                setCategories(newCats);
                setDraggedColIdx(null);
            };

            return (
                <div className="min-h-screen pb-40">
                    <nav className="bg-white border-b px-6 py-4 sticky top-0 z-40 backdrop-blur-md bg-white/80">
                        <div className="max-w-[1800px] mx-auto flex justify-between items-center">
                            <div className="flex items-center gap-3">
                                <div className="p-2 bg-indigo-600 rounded-lg text-white shadow-lg shadow-indigo-100">
                                    <Icon name="ShoppingBasket" />
                                </div>
                                <div>
                                    <h1 className="font-bold text-lg leading-none">SmartGrocer</h1>
                                    <span className="text-[10px] text-slate-400 font-bold uppercase tracking-widest">Master List</span>
                                </div>
                            </div>
                            <div className="flex items-center gap-2">
                                <button onClick={addColumn} className="text-sm font-bold text-indigo-600 bg-indigo-50 px-4 py-2 rounded-xl border border-indigo-100 hover:bg-indigo-100 transition-colors flex items-center gap-2">
                                    <Icon name="Plus" size={16} /> Add Column
                                </button>
                                <button onClick={() => setItems(items.filter(i => !i.completed))} className="text-sm font-bold text-slate-500 hover:text-red-600 px-4 py-2 rounded-xl hover:bg-red-50 transition-colors flex items-center gap-2">
                                    <Icon name="Trash2" size={16} /> Clear
                                </button>
                            </div>
                        </div>
                    </nav>

                    <div className="max-w-[1800px] mx-auto p-6 flex flex-wrap gap-6 justify-start items-start">
                        {categories.map((cat, idx) => (
                            <div 
                                key={cat.id} 
                                draggable 
                                onDragStart={(e) => onDragStartCol(e, idx)}
                                onDragOver={(e) => e.preventDefault()}
                                onDrop={(e) => onDropCol(e, idx)}
                                className={`flex flex-col w-full sm:w-[320px] transition-all ${draggedColIdx === idx ? 'opacity-40 grayscale scale-95' : 'opacity-100'}`}
                            >
                                <div className={`p-4 rounded-t-2xl border-x border-t font-bold flex justify-between items-center cursor-grab active:cursor-grabbing ${cat.color}`}>
                                    <div className="flex items-center gap-2 overflow-hidden">
                                        <span className="flex-shrink-0">{cat.icon}</span>
                                        <input 
                                            value={cat.name}
                                            onChange={(e) => setCategories(categories.map(c => c.id === cat.id ? {...c, name: e.target.value} : c))}
                                            className="bg-transparent border-none outline-none w-full focus:ring-1 focus:ring-black/5 rounded px-1"
                                        />
                                    </div>
                                    <div className="flex items-center gap-2">
                                        <span className="text-[10px] bg-white/40 px-2 py-0.5 rounded-lg">{items.filter(i => i.category === cat.id).length}</span>
                                        <button onClick={() => deleteColumn(cat.id)} className="text-current opacity-30 hover:opacity-100 transition-opacity"><Icon name="X" size={14} /></button>
                                    </div>
                                </div>
                                <div className="bg-white border-x border-b rounded-b-2xl flex-1 shadow-sm overflow-hidden">
                                    <div className="p-2 border-b bg-slate-50/50">
                                        <div className="flex items-center gap-2 px-2 bg-white border border-slate-200 rounded-lg focus-within:ring-2 focus-within:ring-indigo-100 transition-all">
                                            <Icon name="Plus" size={14} className="text-slate-400" />
                                            <input 
                                                placeholder="Add item..." 
                                                className="w-full text-sm py-2 outline-none"
                                                onKeyDown={(e) => { if(e.key === 'Enter') { addItem(e.target.value, cat.id); e.target.value = ''; }}}
                                            />
                                        </div>
                                    </div>
                                    <div className="p-2 space-y-1 min-h-[100px] max-h-[500px] overflow-y-auto scrollbar-thin">
                                        {items.filter(i => i.category === cat.id).length === 0 ? (
                                            <div className="py-10 flex flex-col items-center justify-center text-slate-300 opacity-50 italic">
                                                <Icon name="LayoutGrid" size={20} strokeWidth={1.5} />
                                                <span className="text-[10px] uppercase font-bold tracking-widest mt-2">Empty</span>
                                            </div>
                                        ) : (
                                            items.filter(i => i.category === cat.id).map(item => (
                                                <div key={item.id} className="flex items-start gap-2 p-2.5 hover:bg-slate-50 rounded-xl group transition-colors border border-transparent hover:border-slate-100">
                                                    <button onClick={() => toggleItem(item.id)} className={`mt-0.5 flex-shrink-0 transition-colors ${item.completed ? 'text-indigo-600' : 'text-slate-300 hover:text-indigo-200'}`}>
                                                        <Icon name={item.completed ? 'CheckSquare' : 'Square'} size={20} />
                                                    </button>
                                                    <span className={`text-sm flex-1 break-words leading-tight ${item.completed ? 'line-through text-slate-400' : 'text-slate-700 font-medium'}`}>{item.text}</span>
                                                    <button onClick={() => deleteItem(item.id)} className="opacity-0 group-hover:opacity-100 text-slate-300 hover:text-red-500 transition-all"><Icon name="Trash2" size={14} /></button>
                                                </div>
                                            ))
                                        )}
                                    </div>
                                </div>
                            </div>
                        ))}
                        
                        <button onClick={addColumn} className="w-full sm:w-[320px] h-32 border-2 border-dashed border-slate-200 rounded-2xl flex flex-col items-center justify-center text-slate-400 hover:border-indigo-300 hover:text-indigo-500 transition-all group">
                            <Icon name="Plus" size={24} className="group-hover:scale-110 transition-transform" />
                            <span className="text-[10px] font-bold uppercase tracking-widest mt-2">New Column</span>
                        </button>
                    </div>

                    <div className={`fixed bottom-0 left-0 w-full transition-transform duration-300 z-50 ${showQuickAdd ? 'translate-y-0' : 'translate-y-[calc(100%-44px)]'}`}>
                        <div className="max-w-4xl mx-auto px-6">
                            <button onClick={() => setShowQuickAdd(!showQuickAdd)} className="mx-auto block bg-slate-800 text-white px-8 py-2.5 rounded-t-2xl text-[10px] font-bold tracking-[0.2em] flex items-center gap-3 shadow-2xl hover:bg-slate-700 transition-colors">
                                <Icon name="Zap" size={12} fill="#fbbf24" className="text-amber-400 stroke-none" /> QUICK FAVORITES <Icon name="ArrowDownUp" size={10} className={showQuickAdd ? 'rotate-180' : ''} />
                            </button>
                            <div className="bg-white/95 backdrop-blur-xl border-t border-slate-200 p-6 h-36 flex gap-4 overflow-x-auto scrollbar-thin shadow-2xl rounded-t-3xl">
                                {frequentItems.length === 0 ? (
                                    <div className="flex items-center justify-center w-full text-slate-400 text-xs italic gap-3">
                                        <Icon name="History" size={16} /> Start adding items to track your favorites
                                    </div>
                                ) : (
                                    frequentItems.map(f => {
                                        const cat = categories.find(c => c.id === f.lastCat) || categories[0];
                                        return (
                                            <button 
                                                key={f.text} 
                                                onClick={() => addItem(f.label, f.lastCat)}
                                                className="flex-shrink-0 bg-white border border-slate-200 p-3 rounded-2xl hover:border-indigo-500 hover:shadow-md transition-all active:scale-95 text-center min-w-[120px] flex flex-col justify-between"
                                            >
                                                <div className="flex justify-between items-center mb-1">
                                                    <span className="text-lg">{cat?.icon || 'ðŸ“¦'}</span>
                                                    <span className="text-[10px] font-black bg-indigo-50 text-indigo-600 px-1.5 py-0.5 rounded-md">{f.count}</span>
                                                </div>
                                                <div className="text-xs font-bold truncate text-slate-700">{f.label}</div>
                                            </button>
                                        );
                                    })
                                )}
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
